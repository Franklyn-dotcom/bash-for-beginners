#!/bin/bash

# A script that allows users to quickly upload files
# to a specified cloud storage solution, providing a simple and seamless 
# upload experience similar to popular storage services.


setup() { 
    # Install civo cli
    curl -sL https://civo.com/get | sudo bash

    # Add civo api key for authentication

#    civo apikey add Demo_Test <api-key>
    echo "Api key added successfully."
    echo -e "\n\n"
}

# create and list the object credential store in your account 

create_obj_cred(){
    # delete existing credential 
    #civo objectstore credential delete project-cred --region FRA1
    #civo objectstore credential delete project-cred --region LON1

    #create the obj store credential 
    #civo objectstore credential create project-cred --region FRA1

    #echo "Credential created successfully"

    # list the obj store credential
    civo objectstore credential ls --region FRA1
 
    echo -e "\n"
}

create_obj_store(){
    #check if there's any existing created objectstore 
    civo objectstore ls
    echo -e "\n"
    # create object store 
    #civo objectstore create project-obj-store --region FRA1
}

upload_files_store(){
    #install s3cmd
    #sudo pip install s3cmd

    # create a for loop to enable user to upload selected file or all the files
    declare -a arr=($@)
    for i in ${arr[@]}
    do

    #check if it is a file
    if [[ -f "$i" ]];
    then


        if [[ -n $file_exists  ]];
        then

            read -p "File '${i}' already exists. What would you like to do? (o)verwrite, (s)kip " choice
            case $choice in
            o | O)
                 pv "$i" | s3cmd --host=objectstore.fra1.civo.com  --host-bucket=s3://project-obj-store put --acl-public "$i" s3://project-obj-store
                 echo "$i file  overwritten successfully"
                 ;;
            s | S)
                 echo "Skipping $i"
                 ;;
            esac

        else
            while true;
            do
              read -p "Do you want to upload $i file: y | n " upload_file
              if [[ $upload_file =~ [yY] ]];
              then
                  pv "$i" | s3cmd --host=objectstore.fra1.civo.com  --host-bucket=s3://project-obj-store put --acl-public "$i" s3://project-obj-store
                  echo "Successfully uploaded $i"
                  break 1

              elif [[ $upload_file =~ [nN] ]];
              then
                  echo "Okay. Skipping $i"
                  break

              else
                  echo "You didn't select any choice. 0 file Uploaded." 

              fi
            done
        fi
    else
        echo "No file found. It might be a directory"

    fi
    done
}



file_nae=("create_resource_group" "create_storage_instance" "hello-dummy.txt")


#setup
#create_obj_cred
#create_obj_store
upload_files_store ${file_nae[@]}
